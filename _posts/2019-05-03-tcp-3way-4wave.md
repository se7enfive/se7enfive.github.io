---
layout: post
title: TCP 三次握手与四次挥手
subtitle: 报文字段、状态迁移与常见问题
date: 2019-05-03
categories: 技术
tags: TCP 三次握手 四次挥手 可靠传输
cover: 
---

本文归纳 TCP 连接的建立与释放流程，结合关键首部字段与状态迁移点。

## 三次握手（SYN → SYN+ACK → ACK）
- 目的：同步初始序列号 ISN，确认对端可达，初始化参数
- 关键字段：SYN、ACK、Seq、Ack
- 常见问题：SYN Flood、半连接队列、SYN Cookies

## 四次挥手（FIN/ACK 往返）
- 原因：双向通道需分别关闭（半关闭）
- 关键状态：FIN_WAIT_1、FIN_WAIT_2、CLOSE_WAIT、LAST_ACK、TIME_WAIT
- TIME_WAIT 要点：2MSL 的必要性、端口复用影响、调优风险

## 报文字段速查
- 端口、Seq/Ack、窗口、校验和、标志位（URG/ACK/PSH/RST/SYN/FIN）
- MSS、窗口扩大、时间戳、SACK 等可选项

## 故障与调优提示
- 三握卡顿：丢包/防火墙/队列满
- 四挥长尾：对端迟迟不发 FIN；CLOSE_WAIT 堆积是应用未 close
- 连接数爆发：半连接与全连接队列参数、内核 TCP backlog、端口耗尽

—— 完 ——


